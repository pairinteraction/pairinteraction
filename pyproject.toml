[build-system]
requires = [  # keep this in sync with project.optional-dependencies.build
  "scikit-build-core >=0.9.0",
  "nanobind >=1.9.0",
  "numpy >= 1.24",
]
build-backend = "scikit_build_core.build"


[project]
name = "pairinteraction"
dynamic = ["version"]
description = "A Rydberg Interaction Calculator"
readme = "README.md"
keywords = ["rydberg", "atom interactions", "pair potentials", "mqdt", "quantum physics"]
authors = [
    { name = "Pairinteraction Developers" },
]
maintainers = [
    { name = "Sebastian Weber", email = "seweber@posteo.de" },
    { name = "Henri Menke", email = "henri@henrimenke.de" },
    { name = "Johannes MÃ¶gerle", email = "johannes.moegerle@itp3.uni-stuttgart.de" },
]
classifiers = [
  "Intended Audience :: Science/Research",
  "Topic :: Scientific/Engineering :: Physics",
  "Programming Language :: Python :: 3.8",
  "Programming Language :: Python :: 3.9",
  "Programming Language :: Python :: 3.10",
  "Programming Language :: Python :: 3.11",
  "Programming Language :: Python :: 3.12",
  "Operating System :: MacOS",
  "Operating System :: Microsoft :: Windows",
  "Operating System :: POSIX :: Linux",
  "License :: OSI Approved :: GNU General Public License v3 or later (GPLv3+)",
  "License :: OSI Approved :: GNU Lesser General Public License v3 or later (LGPLv3+)",
]
requires-python = ">=3.8"
dependencies = [
  "mkl; sys_platform != 'darwin'",
  "mkl-devel; sys_platform != 'darwin'",
  "numpy >= 1.24",
  "scipy >= 1.10",
  "pydantic  >=  2.3",
]

[project.optional-dependencies]
gui = [
  "pyqt5 >= 5.15.8",
  "pyqtgraph >= 0.13",
  "pint >= 0.21",
]
doc = [
  "sphinx < 7",
  "sphinx-rtd-theme",
  "sphinxcontrib-mermaid",
  "nbsphinx",
  "nbconvert",
  # "autodoc_pydantic[erdantic]",
]
test = [
  "pytest >= 8.0",
  "pytest-qt >= 4.2",
  "nbmake >= 1.3",
]
build = [  # keep this in sync with build-system.requires
  "scikit-build-core >=0.9.0",
  "nanobind >=1.9.0",
  "numpy >= 1.24",
]

[project.urls]
Homepage = "https://www.pairinteraction.org"
Repository = "https://github.com/pairinteraction/pairinteraction"

[project.scripts]
start_pairinteraction_gui = "pairinteraction.gui.start_pairinteraction_gui:main"


[tool.scikit-build]
cmake.verbose = true
wheel.packages = [
  "src/pairinteraction",
]
wheel.py-api = "py3"
wheel.license-files = ["LICENSE-*.txt"]
sdist.exclude = ["*.cpp", "*.hpp", "CMakeLists.txt", "*.cmake"]

[tool.scikit-build.metadata.version]
provider = "scikit_build_core.metadata.regex"
input = "src/pairinteraction/__init__.py"


[tool.cibuildwheel]
build = [
  "cp38-manylinux_x86_64",
  "cp38-win_amd64",
  "cp38-macosx_x86_64",
]
build-verbosity = 1

test-extras = ["test", "gui"]
test-command = [
  "python -c \"import pairinteraction\"",
  "python -c \"from pairinteraction import backend\"",
  "python -c \"from pairinteraction import gui\"",
  "pytest -v {project}/tests",
]

manylinux-x86_64-image = "ghcr.io/atom-pairinteraction/pairinteraction-manylinux:docker"
environment-pass = ["CXXFLAGS", "VERBOSE"]

[tool.cibuildwheel.linux.environment]
QT_QPA_PLATFORM = "offscreen"
CXXFLAGS = "-march=broadwell"

[tool.cibuildwheel.macos.environment]
QT_QPA_PLATFORM = "offscreen"
MACOSX_DEPLOYMENT_TARGET = "10.15"

[tool.cibuildwheel.windows.environment]
QT_QPA_PLATFORM = "offscreen"
CXXFLAGS = "/Ox /arch:AVX2"

[tool.cibuildwheel.windows]
before-all = "pip install delvewheel" # build-system.requires is unavailable in the build venv
repair-wheel-command = "delvewheel repair --ignore-in-wheel -w {dest_dir} {wheel}"

[tool.pytest.ini_options]
testpaths = [
  "tests",
  "doc/sphinx/examples_python",
]
addopts = [
    "--import-mode=importlib",
    "--nbmake",
]


[tool.ruff]
line-length = 120
target-version = "py38"
select = ["F", "E", "B", "C", "W", "I", "UP", "TID25"]
extend-ignore = ["E741", "C901", "B905"]
extend-include = ["*.ipynb"]

[tool.ruff.per-file-ignores]
"src/pairinteraction/gui/app.py" = ["E402"]

[tool.ruff.flake8-tidy-imports]
ban-relative-imports = "all"


[tool.sonar]
projectKey = "pairinteraction_pairinteraction"
organization = "pairinteraction"
python.version = 3
sources = ["src"]
